(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{497:function(a,s,t){"use strict";t.r(s);var e=t(4),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"一、-安装前准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、-安装前准备"}},[a._v("#")]),a._v(" 一、 安装前准备")]),a._v(" "),t("h3",{attrs:{id:"_1-1-检查系统版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-检查系统版本"}},[a._v("#")]),a._v(" 1.1 检查系统版本")]),a._v(" "),t("p",[a._v("Docker 要求 CentOS 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的CentOS 版本是否支持 Docker。")]),a._v(" "),t("p",[a._v("通过 "),t("code",[a._v("uname -r")]),a._v(" 命令查看你当前的内核版本")]),a._v(" "),t("img",{attrs:{src:a.$withBase("/linux/2020090401-01.png"),alt:"mixureSecure"}}),a._v(" "),t("p",[a._v("如果内核版本低于3.10使用 "),t("code",[a._v("sudo yum update")]),a._v(" 更新")]),a._v(" "),t("h3",{attrs:{id:"_1-2-卸载旧版本（如果安装过旧版本的话）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-卸载旧版本（如果安装过旧版本的话）"}},[a._v("#")]),a._v(" 1.2 卸载旧版本（如果安装过旧版本的话）")]),a._v(" "),t("p",[t("code",[a._v("sudo yum remove docker docker-common docker-selinux docker-engine")])]),a._v(" "),t("h2",{attrs:{id:"二、-开始安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、-开始安装"}},[a._v("#")]),a._v(" 二、 开始安装")]),a._v(" "),t("h3",{attrs:{id:"_2-1-安装需要的软件包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装需要的软件包"}},[a._v("#")]),a._v(" 2.1 安装需要的软件包")]),a._v(" "),t("p",[t("code",[a._v("sudo yum install -y yum-utils device-mapper-persistent-data lvm2")])]),a._v(" "),t("p",[a._v("yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的")]),a._v(" "),t("h3",{attrs:{id:"_2-2-设置yum源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-设置yum源"}},[a._v("#")]),a._v(" 2.2 设置yum源")]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("h3",{attrs:{id:"_2-3-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-安装"}},[a._v("#")]),a._v(" 2.3 安装")]),a._v(" "),t("p",[t("code",[a._v("sudo yum install <FQPN>")])]),a._v(" "),t("p",[a._v("例如：sudo yum install -y docker-ce-17.12.0.ce")]),a._v(" "),t("p",[a._v("安装默认版本")]),a._v(" "),t("p",[t("code",[a._v("sudo yum install -y docker-ce")])]),a._v(" "),t("p",[a._v("由于repo中默认只开启stable仓库，故这里安装的是最新稳定版17.12.0")]),a._v(" "),t("h3",{attrs:{id:"_2-4-启动并加入开机启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-启动并加入开机启动"}},[a._v("#")]),a._v(" 2.4 启动并加入开机启动")]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl start docker\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" docker\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("h3",{attrs:{id:"_2-5-验证安装是否成功"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-验证安装是否成功"}},[a._v("#")]),a._v(" 2.5 验证安装是否成功")]),a._v(" "),t("p",[t("code",[a._v("docker version")])]),a._v(" "),t("p",[a._v("有client和service两部分表示docker安装启动都成功了")]),a._v(" "),t("h2",{attrs:{id:"三、-安装报错"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、-安装报错"}},[a._v("#")]),a._v(" 三、 安装报错")]),a._v(" "),t("h3",{attrs:{id:"_3-1-container-selinux-2-9"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-container-selinux-2-9"}},[a._v("#")]),a._v(" 3.1 container-selinux >= 2.9")]),a._v(" "),t("p",[a._v("这个报错是container-selinux版本低或者是没安装的原因yum 安装container-selinux 一般的yum源又找不到这个包需要安装epel源 才能yum安装container-selinux\n然后在安装docker-ce就可以了。")]),a._v(" "),t("p",[t("code",[a._v("wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo")])]),a._v(" "),t("p",[a._v("阿里云上的epel源")]),a._v(" "),t("p",[t("code",[a._v("yum install epel-release")])]),a._v(" "),t("p",[a._v("然后")]),a._v(" "),t("p",[t("code",[a._v("yum install container-selinux")])]),a._v(" "),t("h2",{attrs:{id:"四、-基础命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、-基础命令"}},[a._v("#")]),a._v(" 四、 基础命令")]),a._v(" "),t("h3",{attrs:{id:"_4-1-查找docker-镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-查找docker-镜像"}},[a._v("#")]),a._v(" 4.1 查找docker 镜像")]),a._v(" "),t("p",[t("code",[a._v("docker search <关键字>")])]),a._v(" "),t("h3",{attrs:{id:"_4-2-下载docker-镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-下载docker-镜像"}},[a._v("#")]),a._v(" 4.2 下载docker 镜像")]),a._v(" "),t("p",[t("code",[a._v("docker pull <镜像名称>")])]),a._v(" "),t("h3",{attrs:{id:"_4-3-启动docker-镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-启动docker-镜像"}},[a._v("#")]),a._v(" 4.3 启动docker 镜像")]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("docker run -i -t -v /root/Downloads/:/mnt/software/ "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("镜像id"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("初始命令"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\ndocker run -i -t -v /usr/local/docker/:/mnt/software/ rdl/javaweb:1.0 /bin/bash\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("其中，相关参数包括：")]),a._v(" "),t("p",[a._v("-i：表示以“交互模式”运行容器")]),a._v(" "),t("p",[a._v("-t：表示容器启动后会进入其命令行")]),a._v(" "),t("p",[a._v("-v：表示需要将本地哪个目录挂载到容器中，格式：v <宿主机目录>:<容器目录>")]),a._v(" "),t("p",[a._v("其他参数:")]),a._v(" "),t("p",[a._v("--name 设置容器名称")]),a._v(" "),t("p",[a._v("--restart=always 在宿主机重启后或者Docker服务重启后自动启动容器，no 不重启(不带restart参数时，默认不重启) on-failure 退出状态非0时重启 always 始终重启")]),a._v(" "),t("h3",{attrs:{id:"_4-4-退出容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-退出容器"}},[a._v("#")]),a._v(" 4.4 退出容器")]),a._v(" "),t("p",[a._v("使用 "),t("code",[a._v("Ctrl+d")]),a._v(" 或输入 "),t("code",[a._v("exit")])]),a._v(" "),t("h3",{attrs:{id:"_4-4-容器操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-容器操作"}},[a._v("#")]),a._v(" 4.4 容器操作")]),a._v(" "),t("h4",{attrs:{id:"_4-4-1-启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-启动"}},[a._v("#")]),a._v(" 4.4.1 启动")]),a._v(" "),t("p",[t("code",[a._v("docker start 容器ID|容器名称")])]),a._v(" "),t("h4",{attrs:{id:"_4-4-2-停止"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-2-停止"}},[a._v("#")]),a._v(" 4.4.2 停止")]),a._v(" "),t("p",[t("code",[a._v("docker stop 容器ID|容器名称")])]),a._v(" "),t("h4",{attrs:{id:"_4-4-3-重启"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-3-重启"}},[a._v("#")]),a._v(" 4.4.3 重启")]),a._v(" "),t("p",[t("code",[a._v("docker restart 容器ID|容器名称")])]),a._v(" "),t("h4",{attrs:{id:"_4-4-4-删除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-4-删除"}},[a._v("#")]),a._v(" 4.4.4 删除")]),a._v(" "),t("p",[t("code",[a._v("docker rm 容器ID|容器名称")])]),a._v(" "),t("h4",{attrs:{id:"_4-4-5-进入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-5-进入"}},[a._v("#")]),a._v(" 4.4.5 进入")]),a._v(" "),t("p",[t("code",[a._v("docker attach 容器ID|容器名称")])]),a._v(" "),t("p",[t("code",[a._v("docker exec-it 容器ID|容器名称 bash")])]),a._v(" "),t("h4",{attrs:{id:"_4-4-6-查看容器端口的映射情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-6-查看容器端口的映射情况"}},[a._v("#")]),a._v(" 4.4.6 查看容器端口的映射情况")]),a._v(" "),t("p",[t("code",[a._v("docker port 容器ID|容器名称")])]),a._v(" "),t("h4",{attrs:{id:"_4-4-7-列出所有容器ip"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-7-列出所有容器ip"}},[a._v("#")]),a._v(" 4.4.7 列出所有容器ip")]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("docker inspect -f"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{{.Name}} {{.NetworkSettings.IPAddress}} {{.HostConfig.PortBindings}}'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("docker "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" -aq"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h4",{attrs:{id:"_4-4-8-列出无用的卷"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-8-列出无用的卷"}},[a._v("#")]),a._v(" 4.4.8 列出无用的卷")]),a._v(" "),t("p",[t("code",[a._v("docker volume ls -qf dangling=true")])]),a._v(" "),t("h3",{attrs:{id:"_4-5-docker清理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-docker清理"}},[a._v("#")]),a._v(" 4.5 docker清理")]),a._v(" "),t("h4",{attrs:{id:"_4-5-1-删除所有退出状态的容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-1-删除所有退出状态的容器"}},[a._v("#")]),a._v(" 4.5.1 删除所有退出状态的容器")]),a._v(" "),t("p",[t("code",[a._v("docker container prune")])]),a._v(" "),t("h4",{attrs:{id:"_4-5-2-删除未被使用的数据卷"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-2-删除未被使用的数据卷"}},[a._v("#")]),a._v(" 4.5.2 删除未被使用的数据卷")]),a._v(" "),t("p",[t("code",[a._v("docker volume prune")])]),a._v(" "),t("h4",{attrs:{id:"_4-5-3-删除-dangling-或所有未被使用的镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-3-删除-dangling-或所有未被使用的镜像"}},[a._v("#")]),a._v(" 4.5.3 删除 dangling 或所有未被使用的镜像")]),a._v(" "),t("p",[t("code",[a._v("docker image prune")])]),a._v(" "),t("h4",{attrs:{id:"_4-5-4-清理所有未使用-卷-容器-镜像-慎用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-4-清理所有未使用-卷-容器-镜像-慎用"}},[a._v("#")]),a._v(" 4.5.4 清理所有未使用 (卷,容器,镜像) 慎用")]),a._v(" "),t("p",[t("code",[a._v("docker system prune --all --force --volumes")])]),a._v(" "),t("h4",{attrs:{id:"_4-5-5-清理所有-卷-容器-镜像-慎用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-5-清理所有-卷-容器-镜像-慎用"}},[a._v("#")]),a._v(" 4.5.5 清理所有 (卷,容器,镜像) 慎用")]),a._v(" "),t("p",[t("code",[a._v("docker stop $(docker container ls -a -q) && docker system prune --all --force --volumes")])]),a._v(" "),t("h3",{attrs:{id:"_4-6-日志查看"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-日志查看"}},[a._v("#")]),a._v(" 4.6 日志查看")]),a._v(" "),t("p",[t("code",[a._v("docker logs [OPTIONS] CONTAINER")])]),a._v(" "),t("blockquote",[t("p",[a._v("Options:")]),a._v(" "),t("blockquote",[t("p",[a._v("--details 显示更多信息\n-f,--follow 跟踪实时日志")]),a._v(" "),t("p",[a._v("--since string  从日志末尾显示多少行日志，默认是all")]),a._v(" "),t("p",[a._v("--tail string 显示自某个timestamp之后的日志，或相对时间，如42m （即42分钟）")]),a._v(" "),t("p",[a._v("-t,--timestamps 显示时间戳")]),a._v(" "),t("p",[a._v("--until string  显示自某个timestamp之前的日志，或相对时间，如42m （即42分钟）")])])]),a._v(" "),t("h3",{attrs:{id:"_4-7-docker-命令无法自动补全"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-docker-命令无法自动补全"}},[a._v("#")]),a._v(" 4.7 Docker 命令无法自动补全")]),a._v(" "),t("h4",{attrs:{id:"_4-7-1-安装bash-complete"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-1-安装bash-complete"}},[a._v("#")]),a._v(" 4.7.1 安装bash-complete")]),a._v(" "),t("p",[a._v("yum install -y bash-completion")]),a._v(" "),t("h4",{attrs:{id:"_4-7-2-刷新文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-2-刷新文件"}},[a._v("#")]),a._v(" 4.7.2 刷新文件")]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" /usr/share/bash-completion/completions/docker\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" /usr/share/bash-completion/bash_completion\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("h2",{attrs:{id:"五、-限制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#五、-限制"}},[a._v("#")]),a._v(" 五、 限制")]),a._v(" "),t("h3",{attrs:{id:"_5-1-限制docker日志大小"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-限制docker日志大小"}},[a._v("#")]),a._v(" 5.1 限制docker日志大小")]),a._v(" "),t("h4",{attrs:{id:"_5-1-1-更改文件，添加内容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-更改文件，添加内容"}},[a._v("#")]),a._v(" 5.1.1 更改文件，添加内容")]),a._v(" "),t("p",[t("code",[a._v("vim /etc/docker/daemon.json")])]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"log-driver"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"json-file"')]),a._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"log-opts"')]),a._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"max-size"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"50M"')]),a._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"max-file"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"3"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("h4",{attrs:{id:"_5-1-2-重启docker服务（容器需要删掉重启）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-重启docker服务（容器需要删掉重启）"}},[a._v("#")]),a._v(" 5.1.2 重启docker服务（容器需要删掉重启）")]),a._v(" "),t("p",[a._v("systemctl restart docker.service")]),a._v(" "),t("h3",{attrs:{id:"_5-2-限制内存大小"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-限制内存大小"}},[a._v("#")]),a._v(" 5.2 限制内存大小")]),a._v(" "),t("p",[a._v("启动时添加参数")]),a._v(" "),t("p",[t("code",[a._v("-m 500M --memory-reservation 200M")])])])}),[],!1,null,null,null);s.default=r.exports}}]);